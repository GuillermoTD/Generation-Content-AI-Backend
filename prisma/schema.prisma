generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ========================================
// USUARIOS Y AUTENTICACIÓN
// ========================================
model User {
  id       String   @id @default(cuid())
  email    String   @unique
  password String
  name     String?
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Créditos y suscripción
  credits  Int      @default(10)
  planType PlanType @default(FREE)
  
  // Relaciones
  generations Generation[]
  projects    Project[]
  
  @@map("users")
}

enum PlanType {
  FREE
  BASIC
  PRO
  ENTERPRISE
}

// ========================================
// PROYECTOS Y ORGANIZACIÓN
// ========================================
model Project {
  id          String   @id @default(cuid())
  name        String
  description String?
  color       String? // Para identificación visual
  
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relaciones
  generations Generation[]
  
  @@map("projects")
}

// ========================================
// GENERACIÓN DE CONTENIDO DE TEXTO
// ========================================
model Generation {
  id String @id @default(cuid())
  
  // Tipo de contenido
  type ContentType
  
  // Input del usuario
  prompt   String  @db.Text
  tone     String? // professional, casual, humorous, etc.
  length   String? // short, medium, long
  language String  @default("es")
  
  // Output generado
  content String @db.Text
  
  // Metadata
  model      String @default("gpt-4") // Modelo de IA usado
  tokensUsed Int?
  
  // Rating y favoritos
  rating     Int?     @db.SmallInt // 1-5 estrellas
  isFavorite Boolean  @default(false)
  
  // Relaciones
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relaciones
  versions GenerationVersion[]
  
  @@map("generations")
  @@index([userId])
  @@index([type])
  @@index([createdAt])
}

enum ContentType {
  INSTAGRAM_POST
  FACEBOOK_POST
  TWITTER_POST
  LINKEDIN_POST
  TIKTOK_SCRIPT
  YOUTUBE_SCRIPT
  BLOG_ARTICLE
  BLOG_INTRO
  BLOG_CONCLUSION
  EMAIL_MARKETING
  AD_COPY
  PRODUCT_DESCRIPTION
}

// ========================================
// VERSIONADO DE CONTENIDO
// ========================================
model GenerationVersion {
  id      String  @id @default(cuid())
  content String  @db.Text
  prompt  String? @db.Text
  
  generationId String
  generation   Generation @relation(fields: [generationId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@map("generation_versions")
  @@index([generationId])
}